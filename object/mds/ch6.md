# Chapter 6. 메시지와 인터페이스

## 협력과 메시지
- 협력은 클라이언트가 서버의 서비스를 요청하는 단방향 상호작용으로 객체는 보통 협력에 참여하는 동안 클라이언트와 서버의 역할을 동시에 수행한다.

### 1) 메시지와 메서드
- 메시지를 수신했을 때 실제로 수행되는 함수 또는 프러시저를 **메서드**라고 부른다.
- **객체지향에서는 메시지와 메서드가 컴파일 타임와 런타임에 서로 달라질 수 있다.**
    - 객체의 메서드는 런타임에 동적으로 사용할 메서드가 선택되기 때문에 컴파일 타임에 메시지를 수신하는 객체의 타입을 알 수 없다.

> 객체지향적인 특징을 통해 메시지와 실제 메서드가 구분될 수 있기 때문에 클라이언트와 서버는 느슨하게 결합될 수 있고, 이를 통해 유연하고 확장 가능한 코드를 작성할 수 있게 해준다.

### 2) 퍼블릭 인터페이스와 오퍼레이션
- 객체가 외부에 공개하는 메시지의 집합을 **퍼블릭 인터페이스**라고 부른다.
- 퍼블릭 인터페이스에 포함된 메시지를 흔히 **오퍼레이션**이라고 부르며 내부 구현코드가 아닌 단순히 시그니처를 가르키는 경우가 대부분이다.
    - **시그니처**는 오퍼레이션의 이름과 파라미터 목록을 합친것을 의미한다.
- 반면 실제로 메시지를 수신했을 때 실행되는 코드를 **메서드**라고 부른다.

<br>

메시지가 객체의 퍼블릭 인터페이스(메시지 집합)를 결정하고, 객체의 퍼블릭 인터페이스는 객체의 품질을 결정한다.

## 인터페이스와 설계 품질
### 1) 디미터 법칙
- 오직 자신이 의존하는 대상에게만 메시지를 요청하라.
    - 메시지 전송 시 dot(.)을 한번만 사용하도록 하자.
- 디미터 법칙을 지키려고 하면 의존하는 대상에게 현재 내가 원하는 것을 수행해달라고 메시지를 요청하게 될 것이다.
- 이는 저절로 인터페이스가 어떻게 하는지가 아닌 무엇을 하는지만을 알게되어 결합도를 낮출 수 있다.

### 2) 인터페이스는 무엇을 하는지만을 드러내야 한다.
- 인터페이스의 오퍼레이션명이 해당 기능을 어떻게 수행하는지에 대해 깊게 표현하고 있다면 수행 방법이 변경됨에 따라 의존하는 모든 객체들도 변경이 필요해진다.
    - 예를들어 sortByPeriod라는 오퍼레이션이 있을 경우 Period가 아닌 새로운 조건으로 sort 방식을 변경하려고 할 때 의존하는 모든 객체는 변경이 필요하다.
    - 단지 인터페이스의 오퍼레이션명을 **무엇을 하는지**만 표현할 수 있도록 sort로만 명시했다면 새로운 구현방식을 사용하더라도 의존하는 대상은 변경이 필요 없어질 것이다.
    - 그리고 오퍼레이션명이 무엇을 하는지만을 나타내면 이러한 오퍼레이션을 묶어 하나의 인터페이스로 정의할 수 있게 된다. 

> 의도를 드러내는 메서드명을 지을 때 좋은 이름이 생각나지 않는다면 매우 다른 두 번째 구현을 생각해보고 두 번째 구현과 동일한 이름을 붙이도록 해봐라.

## 원칙의 함정
- 위에서 정리한 원칙은 정답이 아니다.
- **원칙을 아는것 보다 더 중요한 것은, 언제 원칙이 유용한지 유용하지 않은지 판단할 수 있는 트레이드 오프 능력을 기르는 것이다.**

### 1) 디미터 법칙은 하나의 도트를 강제하는게 아니다.
- 하나의 도트를 강제한다면 Stream 사용은 불가능해진다.
- **디미터 법칙의 목적은 의존하는 객체간의 캡슐화를 잘지키기 위함이다.**
 
#### 디미터 법칙을 지키려고하다가 응집도를 낮출 수 있다.
- 디미터 법칙을 맹목적으로 지키다보면 객체들의 책임을 적절한곳에 부여하기 어려워질 수 있다.
- 디미터 법칙을 지키려고 엉뚱한 객체가 엉뚱한 책임을 지게하는 것은 훌륭한 객체지향 설계가 아니다.

> 의존하는 객체에게 묻는것도 상황에 따라 필요하다. 원칙은 언제나 지키는 것이 아닌 상황에 맞게 적절히 활용할 수 있는 유연함을 가지자.

## CQRS(명령 쿼리 분리 원칙)
- 부수효과를 발생시킬 수 있으나 값을 반환하지 못하는 **명령**과 부수효과를 발생시키지 못하지만 값을 반환할 수 있는 **쿼리**를 분리하면 복잡도를 줄일 수 있다.
- 명령은 오직 객체의 상태만을 수정할 수 있고, 쿼리는 오직 객체와 관련된 새로운 정보를 반환할 수 있도록하면 이를 사용하는 클라이언트는 예측하기 쉬워지므로 유지보수성이 좋아진다. 

> 객체는 상태와 행위를 동시에 가지기 때문에 상태가 변경되는 부수효과를 가질 수 밖에 없다. 이러한 부수효과는 해당 객체를 사용하는 입장에선 예측을 어렵게 만든다.
> 부수효과를 발생시키는 명령과 그렇지 않는 쿼리로 분리한다면 시스템의 복잡도는 줄어들 것이고 유지보수성이 좋아질 것이다. 

