# 2-3장 스프링 웹 기술과 스프링 MVC
- 스프링은 기술의 변화가 잦은 웹 계층과 다른 계층을 깔금하게 분리해서 개발하는 아키텍처 모델을 지지하고 이 덕분에 웹 계층의 기술 변경이 잦더라도 변경에 영향을 최소화할 수 있다.

## 1. 스프링의 웹 프레젠테이션 계층 기술
- 이전에 애플리케이션 컨텍스트를 서블릿과 루트로 분리했었는데 이러한 방식을 사용하는 이유가 바로 웹 기술을 변경하더라도 기존 스프링 애플리케이션에게 영향을 주지 않게하기 위해서였다.

### 스프링 MVC의 Dispatcher Servlet 전략
- 스프링 MVC 프레임워크를 완성된 고정적인 프레임워크로 보는게 아닌, 요구 사항에 따라 자신만의 웹 프레임워크로 업그레이드시킬 수 있는 도구로 생각하고 사용하여야 한다.
- **이것이 스프링이 제공하는 가치를 누리며 스프링을 잘 사용할 수 있는 비결이다.**

### DispatcherServlet 동작 방식
#### 1) DispatcherServlet의 HTTP 요청 인입
- 모든 요청은 Front Controller인 DispatcherServlet가 받은 후 필요한 전처리(Theme 정보, Local 정보 파악)를 수행한다.

#### 2) DispatcherServlet에서 Controller로 HTTP 요청 위임
- DispatcherServlet은 핸들러 매핑 전략을 이용해 핸들러를 탐색해 컨트롤러에 HTTP 요청을 위임한다.
    - 전략 패턴을 활용해 핸들러를 탐색하기 때문에 전략이라는 단어가 사용됨.
- 가져온 컨트롤러는 다양한 방식으로 구현되어 있을 것이기 때문에 HandlerAdapter를 활용하여 해당 컨트롤러를 호출한다.
    - DispatcherServlet은 어떤 방식으로 컨트롤러가 구현되었는지, 어떤 메서드를 가졌는지 알지 못한다.
    - 그렇기 때문에 HandlerAdapter를 활용하여 작업을 요청하고 해당 결과를 반환받는 기법이 활용된다.
    
#### 3) 컨트롤러의 모델 생성과 정보 등록
- MVC 패턴의 장점은 정보를 담고 있는 모델과 정보를 뿌려줄 뷰가 분리되는 것이다.
- 즉 같은 모델이더라도, 뷰만 달라진다면 다른 방식으로 모델을 활용할 수 있다.
- 컨트롤러의 작업은 **들어오는 요청을 분석, 서비스 계층을 통해 그에 따른 비즈니스 로직 수행, 그 결과를 적절히 변환하여 반환**하는 것이다.

#### 4) 컨트롤러의 결과 리턴: 모델과 뷰
- 컨트롤러는 ModelAndView에 정보를 담아 DispatcherServlet에게 반환해주고, DispatcherServlet은 뷰 리졸버를 통해 뷰 오브젝트를 생성해준다.
- 컨트롤러가 ModelAndView에 담는 View 정보는 View 오브젝트가 아닌 뷰에 관한 정보일 뿐이다.

#### 5) DispatcherServlet의 뷰 호출, 6) 모델 참조
- ModelAndView를 받은 DispatcherServlet은 뷰 리졸버로 생성된 View 오브젝트에게 모델을 전달해주고 클라이언트에게 돌려줄 최종 결과물을 생성해달라고 요청한다.

#### 7) HTTP 응답
- 뷰 생성까지 모두 완료되면 등록된 후처리기를 수행하고 뷰가 만들어준 HttpServletResponse에 담긴 최종 결과를 서블릿 컨테이너에게 돌려준다.
- 서블릿 컨테이너는 HttpServletResponse에 담긴 정보로 HTTP 응답을 만들어 클라이언트에게 반환해준다.


## 2. 컨트롤러
- 스프링 MVC는 컨트롤러 모델을 미리 제한하지 않고, adapter 패턴을 활용하여 여러 컨트롤러의 종류를 필요에 따라 확장할 수 있도록 하였다.

### 핸들러 인터셉터
- 핸들러 매핑의 역할은 URL로부터 컨트롤러를 찾아주는게 전부가 아니다. 핸들러 매핑은 DispatcherServlet으로부터 매핑 작업을 요청받으면 그 결과로 HandlerExecutionChain을 돌려준다.
- HandlerExecutionChain는 handler와 interceptors를 가지고 있어 DispatcherServlet이 원하는 시점에 인터셉터 메서드를 호출할 수 있도록 해준다.

### 뷰 리졸버
- 뷰 이름으로부터 사용 할 뷰 오브젝트를 찾아주는 리졸버로 이 리졸버를 활용하면 직접 뷰를 생성할 필요가 없다.

#### ContentNegotiatingViewResolver
- 사용자가 요청한 미디어 타입, 컨트롤러가 반환하는 뷰 이름, 뷰 리졸버에 등록된 리졸버들을 조합하여 적절한 뷰 리졸버를 사용해 뷰를 생성해주는 리졸버이다.

### ExceptionResolver, LocaleResolver, MultipartResolver
- 예외, 지역정보, 멀티파트 포맷등을 처리하는 리졸저들도 존재한다.


## 내가 생각하는 스프링 MVC의 장점
- 스프링 MVC의 웹 계층과 다른 계층을 깔끔하게 분리하여 사용할 수 있기 때문에 언제든지 다른 웹 기술로 갈아끼울 수 있는 것
- 스프링의 철학 기반으로 구성되었기 때문에 확장성이 좋은 것
    - 핸들러 어댑터와 매핑을 통해 다양한 커스텀 컨트롤러 정의 가능
    - 각 리졸버등을 활용하여 편리한 개발 가능
